<div class="loading-spinner-container" ng-hide="isLoaded">
    <spinner spin="{ length: 50, width: 10, radius: 30 }"></spinner>
</div>

<div ng-show="isLoaded" class="view calendar">
    <div class="col-md-3 left-pane">
        <button ng-hide="campaign.isNew" class="btn full-width small-nudge-down btn-inverse add-content" ng-click="duplicateCampaign()">Duplicate Campaign</button>
        <button ng-hide="campaign.isNew" class="btn full-width small-nudge-down btn-inverse add-content" ng-click="newTask()">Create New Task</button>

        <ul class="task-list">
            <li class="task-task" ng-repeat="task in tasks" ng-class="{ disabled: task.isComplete }">
                <div class="checkbox">
                    <label>
                        <input type="checkbox" style="margin: 3px 0 0 -20px !important;" check-int ng-model="task.isComplete" ng-change="toggleTaskComplete(task)">
                        {{ task.name }} - 
                        <span ng-hide="task.dateCompleted" ng-class="{ error: (task.dueDate | isOverdue) }">
                            Due: {{ task.dueDate ? (task.dueDate | date) : 'N/A' }}
                        </span>
                        <span ng-show="task.dateCompleted">
                            Completed: {{ task.dateCompleted | date }}
                        </span>
                    </label>
                    <span class="fa fa-trash-o" ng-click="deleteTask(task)"></span>
                    <span class="fa fa-pencil" ng-click="editTask(task)"></span>
                    <div>
                        <small>Assigned to {{ task.user.name }}</small>
                    </div>
                </div>
            </li>
        </ul>

    </div>
    <div class="col-md-9 right-pane">
        <h2 class="right-pane-header">Calendar</h2>
        
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-9">
                    <form ng-submit="canEdit && saveCampaign(campaign)">
                        <div class="row">
                            <div class="col-xs-2" ng-show="campaign.color">
                                <span class="wheel-of-color" style="background-color:{{ campaign.color }}"></span>
                            </div>
                            <div class="col-xs-10">
                                <h4>Concept</h4>
                                <p>{{ campaign.concept }}</p>
                            </div>
                        </div> <!-- .row -->

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="title">Title</label>
                                    <input type="text" name="title" class="form-control" id="title" ng-model="campaign.title">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label for="isActive">Active?</label>
                                    <select name="isActive" class="form-control" id="isActive" 
                                            ng-model="campaign.isActive">
                                        <option value="0">Inactive</option>
                                        <option value="1">Active</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="campaignType">Campaign Type</label>
                                    <select name="campaignType" class="form-control" id="campaignType" 
                                        ng-model="campaign.campaignTypeId"
                                        ng-options="type.id as type.name for type in campaignTypes">
                                    </select>
                                </div>
                            </div>
                        </div> <!-- .row -->
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="startDate">Start Date</label>
                                    <input show-weeks="false" show-button-bar="false" datepicker-popup="MM/dd/yyyy" date-only="true" type="text" name="startDate" class="form-control" id="startDate" ng-model="campaign.startDate">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="endDate">End Date</label>
                                    <input show-weeks="false" show-button-bar="false" datepicker-popup="MM/dd/yyyy" date-only="true" type="text" name="endDate" class="form-control" id="endDate" ng-model="campaign.endDate">
                                </div>
                            </div>
                        </div> <!-- .row -->
                        <div class="row" ng-show="false && campaign.isRecurring">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="repeat">Repeat</label>
                                    <select name="repeat" class="form-control" id="repeat" ng-model="schedule.repeat">
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4" ng-if="schedule.repeat == 'daily'">
                                <div class="form-group">
                                    <label for="every">Every</label>
                                    <select class="multi-select" multiple="multiple" ui-select2 name="every" class="form-control" id="every" ng-model="schedule.every">
                                        <option value="sun">Sun</option>
                                        <option value="mon">Mon</option>
                                        <option value="tues">Tues</option>
                                        <option value="wed">Wed</option>
                                        <option value="thurs">Thurs</option>
                                        <option value="fri">Fri</option>
                                        <option value="sat">Sat</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4" ng-if="schedule.repeat == 'weekly'">
                                <div class="form-group">
                                    <label for="every">Every</label>
                                    <select class="multi-select" multiple="multiple" ui-select2 name="every" class="form-control" id="every" ng-model="schedule.every">
                                        <option>1 weeks</option>
                                        <option>2 weeks</option>
                                        <option>3 weeks</option>
                                        <option>4 weeks</option>
                                        <option>5 weeks</option>
                                        <option>6 weeks</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4" ng-if="schedule.repeat == 'monthly'">
                                <div class="form-group">
                                    <label for="every">Every</label>
                                    <select class="multi-select" multiple="multiple" ui-select2 name="every" class="form-control" id="every" ng-model="schedule.every">
                                        <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
                                        <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
                                        <option>11</option><option>12</option><option>13</option><option>14</option><option>15</option>
                                        <option>16</option><option>17</option><option>18</option><option>19</option><option>20</option>
                                        <option>21</option><option>22</option><option>23</option><option>24</option><option>25</option>
                                        <option>26</option><option>27</option><option>28</option><option>29</option><option>30</option>
                                        <option>31</option>
                                    </select>
                                </div>
                            </div>
                        </div> <!-- .row -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="description">Description</label>
                                    <textarea rows="4" name="description" class="form-control" id="description" ng-model="campaign.description"></textarea>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="campaignGoals">Campaign Goals</label>
                                    <textarea rows="4" name="campaignGoals" class="form-control" id="campaignGoals" ng-model="campaign.goals"></textarea>
                                </div>
                            </div>
                        </div> <!-- .row -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="tags">Tags <small>(comma separated)</small></label>
                                    <input type="text" list="tag" name="tags" class="form-control" id="tags" ng-model="campaign.tags">
                                </div>
                            </div>
                            <div class="col-md-6" ng-show="campaign.id">
                                <div class="form-group">
                                    <label for="file">Attach a File</label>
                                    <input ng-file-select="selectFiles($files)" multiple type="file" name="file" id="file">
                                </div>

                                <div ng-repeat="file in files">
                                    <span class="fa fa-trash-o pull-right" ng-click="deleteFile(file)"></span>
                                    <a ng-href="{{ file | imagePathFromObject }}" target="_blank">{{ file.filename }}</a>
                                </div>
                            </div>
                        </div> <!-- .row -->

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="contact">Contact</label>
                                    <input type="text" name="contact" class="form-control" id="contact" ng-model="campaign.contact">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="partners">Partners</label>
                                    <input type="text" name="partners" class="form-control" id="partners" ng-model="campaign.partners">
                                </div>
                            </div>
                        </div> <!-- .row -->

                        <div class="row">
                            <div class="col-md-6" ng-show="shouldShow('speakerName')">
                                <div class="form-group">
                                    <label for="speakerName">Speaker Name</label>
                                    <input type="text" name="speakerName" class="form-control" id="speakerName" ng-model="campaign.speakerName">
                                </div>
                            </div>
                            <div class="col-md-6" ng-show="shouldShow('host')">
                                <div class="form-group">
                                    <label for="host">Host</label>
                                    <input type="text" name="host" class="form-control" id="host" ng-model="campaign.host">
                                </div>
                            </div>
                        </div> <!-- .row -->

                        <div class="row">
                            <div class="col-md-4" ng-show="shouldShow('photoNeeded')">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" name="photoNeeded" id="photoNeeded" check-int ng-model="campaign.photoNeeded"> 
                                        Is Photo Needed?
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4" ng-show="shouldShow('linkNeeded')">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" name="linkNeeded" id="linkNeeded" check-int ng-model="campaign.linkNeeded"> 
                                        Is Link Needed?
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4" ng-show="shouldShow('isSeries')">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" name="isSeries" id="isSeries" check-int ng-model="campaign.isSeries"> 
                                        Is This a Series?
                                    </label>
                                </div>
                            </div>
                        </div> <!-- .row -->

                        <div class="row">
                            <div class="col-md-6" ng-show="shouldShow('type')">
                                <div class="form-group">
                                    <label for="type">Type</label>
                                    <input type="text" name="type" class="form-control" id="type" ng-model="campaign.type">
                                </div>
                            </div>
                            <div class="col-md-6" ng-show="shouldShow('audioLink')">
                                <div class="form-group">
                                    <label for="audioLink">Recorded Audio Link</label>
                                    <input type="text" name="audioLink" class="form-control" id="audioLink" ng-model="campaign.audioLink">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <button ng-show="canEdit" type="submit" class="btn btn-inverse">Save</button>
                                    <button type="button" ng-hide="campaign.isNew" ng-click="deleteCampaign(campaign)" class="btn btn-inverse">Delete</button>
                                    <button type="button" ng-click="cancelCampaign()" class="btn btn-inverse">Cancel</button>
                                </div>
                            </div>
                        </div> <!-- .row -->
                    </form>
                </div> <!-- .col-md-9 -->
                <div class="col-md-3">
                    <div class="panel panel-inverse">
                        <div class="panel-heading">
                            Collaborators
                        </div>
                        <div class="panel-body">
                            <div class="internal-collaborator cl-badge cl-badge-horizontal">
                                <span class="cl-badge-image cl-badge-image-small" style="background-image: url('{{ user.image | imagePathFromObject }}')"></span>
                                <div class="cl-badge-caption">
                                    <strong>{{ campaign.isNew ? user.displayName : campaign.user.name }}</strong><br>
                                    <small style="margin-top: -7px; display: block">Owner</small>
                                </div>
                            </div>

                            <div ng-repeat="collab in campaign.collaborators" class="internal-collaborator cl-badge cl-badge-horizontal">
                                <span class="cl-badge-image cl-badge-image-small" style="background-image: url('{{ collab.image | imagePathFromObject }}')"></span>
                                <div class="cl-badge-caption">
                                    {{ collab.name }}
                                </div>

                                <span class="fa fa-trash-o pull-right" ng-click="removeCollaborator(collab)"></span>
                            </div>

                            <div class="form-group" ng-show="showAddInternal">
                                <select name="additionalCollaborator" id="additionalCollaborator"
                                        ng-change="addCollaborator(collaboratorToAdd)"
                                        ng-model="collaboratorToAdd"
                                        ui-select2="{ formatResult: formatUserItem, formatSelection: formatUserItem, selectOnBlur: true }"
                                        placeholder="-- Add Collaborator --"
                                        ng-options="u as u.name for u in users | exclude:campaign.collaborators track by u.id"
                                    >
                                </select>
                            </div>

                            <span ng-hide="showAddInternal || campaign.isNew" ng-click="showAddInternal = true" class="glyphicon glyphicon-plus-sign"></span>
                        </div>
                    </div> <!-- .panel.panel-inverse -->
                </div> <!-- .col-md-3 (sidebar) -->
            </div> <!-- .row -->

            <div ng-if="campaign && !campaign.isNew" class="create-table-container" ng-controller="CreateController">
                <div ng-include="'/assets/views/content/partials/table-list.html'"></div>
            </div>

        </div> <!-- .container -->
    </div>
</div>